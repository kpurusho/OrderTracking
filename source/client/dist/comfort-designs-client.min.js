/*! 01/05/2015*/
App=Ember.Application.create({LOG_ACTIVE_GENERATION:!0,LOG_TRANSITIONS:!0,LOG_TRANSITIONS_INTERNAL:!0}),App.ApplicationAdapter=DS.RESTAdapter.extend({host:"http://localhost:3000"}),Ember.EasyForm.Config.registerInputType("mydate",App.DatePicker),App.Serializer=DS.RESTSerializer.extend({normalize:function(a,b,c){var d={id:b._id};delete b._id;for(var e in b)d[e.camelize()]=b[e];return this._super(a,d,c)},extractArray:function(a,b,c,d,e){return this._super(a,b,c,d,e)},serializeHasMany:function(a,b,c){var d=c.key,e=DS.RelationshipChange.determineRelationshipType(a.constructor,c);("manyToNone"===e||"manyToMany"===e||"manyToOne"===e)&&(b[d]=Ember.get(a,d).mapBy("id"))}}),App.TaskSerializer=App.Serializer.extend(),App.CustomerSerializer=App.Serializer.extend(),App.MeasurementSerializer=App.Serializer.extend(),App.OrderSerializer=App.Serializer.extend(),App.OrdersummarySerializer=App.Serializer.extend(),App.MeasurementconfigSerializer=App.Serializer.extend(),App.MeasurementitemconfigSerializer=App.Serializer.extend(),App.MeasurementitemSerializer=App.Serializer.extend(),App.Consts={OrderState:{New:"New",InProgress:"InProgress",Done:"Done",Delivered:"Delivered"},MeasurementType:{Blouse:"Blouse",Salwar:"Salwar",Skirt:"Skirt"}},App.CustomersEditController=Ember.ObjectController.extend(Ember.Validations.Mixin,{removedMeasurements:[],actions:{updateCustomer:function(){var a=this.get("model"),b=this,c=function(a){window.alert("Failed to save customer.."),console.log(a.message)},d=function(){console.log("customer saved successfully.."),b.transitionToRoute("customers")};a.get("measurements").then(function(b){var e=b.toArray();async.forEach(e,function(a,b){App.Measurementhelper.saveMeasurement(a,b)},function(){console.log("measurements saved successfully.."),console.log("Trying to save customer.."),a.save().then(d,c)})})},cancelCustomer:function(){var a=this.get("model"),b=this;App.OrderCustomerCommonHelper.cancel(a,function(){b.transitionToRoute("customers")})},editMeasurement:function(a){var b=this.get("model"),c=this;App.Measurementhelper.cloneMeasurement(a,c.store,function(d){c.send("openModal","measurement",d,a,b,!1)})},removeMeasurement:function(a){var b=this.get("model");b.get("measurements").removeObject(a);var c=a.get("isNew");App.Measurementhelper.deleteMeasurement(a,!1),c||this.get("removedMeasurements").push(a)},createMeasurement:function(){var a=this,b=this.get("model"),c=a.store.createRecord("measurement");c.set("type",""),c.set("name",a.get("name")),a.send("openModal","measurement",c,null,b,!0)}},isNew:function(){console.log("calculating isNew");var a=this.get("content").get("id");return a}.property()}),App.CustomersEditController.reopen({validations:{name:{presence:!0},phoneno:{presence:!0,numericality:!0}}}),App.CustomersIndexController=Ember.ArrayController.extend({searchedCustomer:function(){var a=new RegExp(this.get("searchcustomer"),"i");this.get("model").set("content",this.store.filter("customer",function(b){return a.test(b.get("name"))||a.test(b.get("phoneno"))}))}.observes("searchcustomer"),actions:{removeItem:function(a){App.OrderCustomerCommonHelper["delete"](a)}}}),App.CustomersNewController=App.CustomersEditController.extend(),App.MeasurementController=Ember.ObjectController.extend(Ember.Validations.Mixin,{measurementtypes:[],measurementtype:"",init:function(){var a=this;App.MeasurementConfigServiceInstance.findMeasurementTypes(function(b){a.set("measurementtypes",b)}),this._super()},selectionChanged:function(){var a=this,b=this.get("model"),c=this.get("measurementtype"),d=this.get("isNew");""!==c&&void 0!==c&&null!==c&&d&&App.MeasurementConfigServiceInstance.createMeasurementItems(c,function(c){b.set("type",a.get("measurementtype")),b.get("measurementitems").then(function(a){a.clear(),a.pushObjects(c)})})}.observes("measurementtype"),parentModel:null,isNew:!1,originalModel:null,actions:{close:function(){var a=this.get("model");return App.Measurementhelper.deleteMeasurement(a),this.send("closeModal")},updateMeasurement:function(){var a=this.get("model"),b=this.get("parentModel"),c=this.get("isNew");if(c)b.get("measurements").pushObject(a);else{var d=this.get("originalModel");d.set("name",a.get("name")),a.get("measurementitems").then(function(b){var c=b.toArray();d.get("measurementitems").then(function(b){for(var d=b.toArray(),e=0;e<c.length;e++)d[e].setProperties(c[e].toJSON());App.Measurementhelper.deleteMeasurement(a)})})}return this.set("measurementtype",""),this.send("closeModal")}}}),App.MeasurementController.reopen({validations:{name:{presence:!0}}}),App.MeasurementconfigsEditController=Ember.ObjectController.extend({actions:{updateMeasurementType:function(){var a=this.get("model"),b=this,c=function(){console.log("config saved successfully.."),b.transitionToRoute("measurementconfigs")},d=function(a){window.alert("Failed to save. Reason: "+a.responseJSON.message)};App.Measurementhelper.saveMeasurementConfig(a,c,d)},editMeasurementItemConfig:function(a){this.send("openModal","measurementitemconfig",a,null,null,!1)},createMeasurementItemConfig:function(){var a=this.get("model"),b=this.store.createRecord("measurementitemconfig");this.send("openModal","measurementitemconfig",b,null,a,!0)}},isNew:function(){return console.log("calculating isNew"),this.get("model").get("id")}.property()}),App.MeasurementconfigsIndexController=Ember.ArrayController.extend({actions:{removeItem:function(a){App.Measurementhelper.deleteMeasurementConfig(a)},copyItem:function(a){App.Measurementhelper.copyMeasurementConfig(a,this.store)}}}),App.MeasurementitemController=Ember.ObjectController.extend(Ember.Validations.Mixin),App.MeasurementitemController.reopen({validations:{itemvalue:{numericality:!0,measurementValidator:!0}}}),App.MeasurementitemconfigController=Ember.ObjectController.extend(Ember.Validations.Mixin,{parentModel:null,isNew:!1,originalModel:null,actions:{updateMeasurementItemConfig:function(){var a=this.get("model"),b=this.get("parentModel"),c=this.get("isNew");return c&&b.get("measurementitems").pushObject(a),this.send("closeModal")}}}),App.MeasurementitemconfigController.reopen({validations:{itemname:{presence:!0},min:{presence:!0,numericality:!0},max:{presence:!0,numericality:!0}}}),App.MeasurementSelectController=Ember.ObjectController.extend({parentModel:null,isNew:!1,originalModel:null,selectionState:function(){var a=this.get("model");async.forEach(a,function(a,b){a.get("measurements").then(function(a){var c=a.toArray();async.forEach(c,function(a,b){a.set("selected",!1),b()},function(){b()})})},function(){})}.observes("model"),actions:{ok:function(){var a=this.get("parentModel"),b=this.get("model"),c=this;async.forEach(b,function(b,d){b.get("measurements").then(function(b){var e=b.toArray();async.forEach(e,function(b,d){b.get("selected")?App.Measurementhelper.cloneMeasurement(b,c.store,function(b){a.get("measurements").then(function(a){a.pushObject(b),d()})}):d()},function(){d()})})},function(){return c.send("closeModal")})},cancel:function(){return this.send("closeModal")}}}),App.OrdersEditController=Ember.ObjectController.extend(Ember.Validations.Mixin,{states:[App.Consts.OrderState.New,App.Consts.OrderState.InProgress,App.Consts.OrderState.Done,App.Consts.OrderState.Delivered],removedMeasurements:[],ordersummary:function(){var a=App.OrdersummaryService.create();return a.set("store",this.store),a.computesummary(),a}.property("model"),actions:{updateCustomerDetails:function(a){var b=this,c=this.get("customerphoneno");c&&this.store.find("customer",{phoneno:c}).then(function(a){if(a.get("length")>0){var c=a.objectAt(0);b.set("customername",c.get("name")),b.set("customeremailid",c.get("emailid"))}})},updateOrder:function(){var a=this.get("model"),b=this,c=function(){console.log("Order saved successfully"),console.log("Trying to update customer..");var a=b.get("model");b.store.find("customer",{phoneno:b.get("customerphoneno")}).then(function(c){var d=null;d=c.get("length")>0?c.objectAt(0):b.store.createRecord("customer",{name:b.get("customername"),phoneno:b.get("customerphoneno"),emailid:b.get("customeremailid")});var e=[],f=[];d.get("measurements").then(function(a){e=a.toArray()}).then(function(){a.get("measurements").then(function(a){f=a.toArray()}).then(function(){async.forEach(f,function(a,c){for(var f=function(a){App.Measurementhelper.saveMeasurement(a,c)},g=!1,h=0;h<e.length;h++){var i=e[h];if(i.get("name")===a.get("name")&&i.get("type")===a.get("type")){g=!0,App.Measurementhelper.copyMeasurement(a,i,b.store,f);break}}g||App.Measurementhelper.cloneMeasurement(a,b.store,function(a){App.Measurementhelper.saveMeasurement(a,function(){d.get("measurements").then(function(b){b.pushObject(a),c()})})})},function(){d.save(),console.log("customer saved successfully.."),b.transitionToRoute("orders")})})})})},d=function(a){window.alert("Failed to save order.."),console.log(a.message)};a.get("measurements").then(function(e){console.log("Trying to save measurements..");var f=e.toArray();async.forEach(f,function(a,b){App.Measurementhelper.saveMeasurement(a,b)},function(){console.log("measurements saved successfully.."),console.log("Trying to save order.."),a.save().then(c,d),b.get("removedMeasurements").forEach(function(a){App.Measurementhelper.saveMeasurement(a)})})})},cancelOrder:function(){var a=this.get("model"),b=this;b.get("removedMeasurements").forEach(function(a){App.Measurementhelper.rollbackMeasurement(a)}),App.OrderCustomerCommonHelper.cancel(a,function(){b.transitionToRoute("orders")})},editMeasurement:function(a){var b=this.get("model"),c=this;App.Measurementhelper.cloneMeasurement(a,c.store,function(d){c.send("openModal","measurement",d,a,b,!1)})},removeMeasurement:function(a){var b=this.get("model");b.get("measurements").removeObject(a);var c=a.get("isNew");App.Measurementhelper.deleteMeasurement(a,!1),c||this.get("removedMeasurements").push(a)},createMeasurement:function(){var a=this,b=this.get("model"),c=a.store.createRecord("measurement");c.set("type",""),c.set("name",a.get("customername")),a.send("openModal","measurement",c,null,b,!0)},getAllPreviousMeasurement:function(){var a=this.get("customerphoneno");if(!a)return void window.alert("Enter customer phone numbers to get measurements");var b=this.get("model"),c=this;this.store.find("order",{customerphoneno:a,status:App.Consts.OrderState.Delivered}).then(function(d){if(d.get("length")>0){var e=d.toArray();e.sort(function(a,b){return a.get("orderdate")<b.get("orderdate")}),c.send("openModal","measurementSelect",e,null,b,!1)}else window.alert("No measurements found for customer with phone no "+a)})},getRecentMeasurement:function(){var a=this.get("customerphoneno");if(!a)return void window.alert("Enter customer phone numbers to get measurements");var b=this.get("model"),c=this;this.store.find("customer",{phoneno:a}).then(function(d){if(d.get("length")>0){var e=d.objectAt(0);e.get("measurements").then(function(a){for(var d=a.toArray(),e=function(a){b.get("measurements").then(function(b){b.pushObject(a)})},f=0;f<d.length;f++)App.Measurementhelper.cloneMeasurement(d[f],c.store,e)})}else window.alert("No measurements found for customer with phone no "+a)})}},isNew:function(){console.log("calculating isNew");var a=this.get("content").get("id");return a}.property()}),App.OrdersEditController.reopen({validations:{customername:{presence:!0},nopieces:{presence:!0,numericality:!0}}}),App.OrdersIndexController=Ember.ArrayController.extend({states:[App.Consts.OrderState.New,App.Consts.OrderState.InProgress,App.Consts.OrderState.Done,App.Consts.OrderState.Delivered],sortProperties:["orderno"],sortAscending:!1,filterByStatusNew:!1,filterByStatusInProgress:!1,filterByStatusDone:!1,filterByStatusDelivered:!1,filterByDueDate:"0",ordersummary:function(){var a=App.OrdersummaryService.create();return a.set("store",this.store),a.computesummary(),a}.property("model.@each.status"),filter:function(){var a=this.get("filterByStatusNew"),b=this.get("filterByStatusInProgress"),c=this.get("filterByStatusDone"),d=this.get("filterByStatusDelivered"),e=a?App.Consts.OrderState.New+"|":"";e+=b?App.Consts.OrderState.InProgress+"|":"",e+=c?App.Consts.OrderState.Done+"|":"",e+=d?App.Consts.OrderState.Delivered+"|":"",e=e.substring(0,e.length-1);var f=new RegExp(e),g=new RegExp(this.get("searchcustomer"),"i"),h=new RegExp(this.get("searchorder"),"i"),i=new Date;i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);var j=new Date(i),k=(6-i.getDay()+1)%7+1,l=this.get("filterByDueDate");switch(l){case"0":i=void 0,j=void 0;break;case"-1":i=void 0;break;case"1":j.setDate(i.getDate()+k);break;case"2":j.setDate(i.getDate()+k+7);break;case"3":j.setDate(i.getDate()+k+14);break;case"4":j.setDate(i.getDate()+k+21)}var m=this;d?this.store.find("order").then(function(a){m.get("model").set("content",m.store.filter("order",function(a){return f.test(a.get("status"))&&(void 0!==i?i.getTime()<=a.get("duedate").getTime():!0)&&(void 0!==j?a.get("duedate").getTime()<j.getTime():!0)&&(g.test(a.get("customername"))||g.test(a.get("customerphoneno")))&&h.test(a.get("orderno"))})),$("table").trigger("update")}):(m.get("model").set("content",m.store.filter("order",function(a){return f.test(a.get("status"))&&(void 0!==i?i.getTime()<=a.get("duedate").getTime():!0)&&(void 0!==j?a.get("duedate").getTime()<j.getTime():!0)&&(g.test(a.get("customername"))||g.test(a.get("customerphoneno")))&&h.test(a.get("orderno"))})),$("table").trigger("update"))}.observes("filterByStatusNew","filterByStatusInProgress","filterByStatusDone","filterByStatusDelivered","filterByDueDate","searchcustomer","searchorder"),editCounter:function(){return this.filterProperty("selected",!0).get("length")}.property("@each.selected"),itemsSelected:function(){return this.get("editCounter")>0}.property("editCounter"),actions:{sortColumn:function(a){var b=this.get("sortProperties");if(1===b.length&&b[0]===a){var c=this.get("sortAscending");c=c?!1:!0,this.set("sortAscending",c)}else this.set("sortProperties",[a]),this.set("sortAscending",!0)},searchItem:function(){{var a=(this.get("content.length"),this.get("search")),b=new RegExp(a);this.get("model").filter(function(a){return b.test(a.get("customername"))})}},removeItem:function(a){var b=this;App.OrderCustomerCommonHelper["delete"](a,function(){b.filter()})},orderStatusNext:function(a){for(var b=this.states.length,c=0,d=0;b>d;d++)this.states[d]===a.get("status")&&(c=d===b-1?d:d+1);a.set("status",this.states[c]),a.save()},orderStatusPrevious:function(a){for(var b=this.states.length,c=0,d=0;b>d;d++)this.states[d]===a.get("status")&&(c=0===d?d:d-1);a.set("status",this.states[c]),a.save()}}}),App.OrdersNewController=App.OrdersEditController.extend(),App.OrdersPrintController=Ember.ObjectController.extend({actions:{print:function(){window.print(),this.transitionToRoute("orders")},close:function(){this.transitionToRoute("orders")}},tasks:function(){return console.log("getting tasks for printing.."),this.store.find("task")}.property()}),App.OrdersummaryController=Ember.ObjectController.extend({actions:{close:function(){return this.send("closeModal")}}}),App.TasksEditController=Ember.ObjectController.extend(Ember.Validations.Mixin,{parentModel:null,isNew:!1,originalModel:null,actions:{updateTask:function(){var a=this.get("model"),b=(this.get("parentModel"),this.get("isNew"),this),c=function(){console.log("task saved successfully.."),b.transitionToRoute("tasks")},d=function(a){window.alert("Failed to save.."),console.log(a.message)};return a.save().then(c,d),this.send("closeModal")}}}),App.TasksEditController.reopen({validations:{taskname:{presence:!0},seqid:{presence:!0,numericality:!0}}}),App.TasksIndexController=Ember.ArrayController.extend({editCounter:function(){return this.filterProperty("selected",!0).get("length")}.property("@each.selected"),itemsSelected:function(){return this.get("editCounter")>0}.property("editCounter"),actions:{createTask:function(){var a=this.get("model"),b=this.store.createRecord("task");this.send("openModal","tasksEdit",b,null,a,!0)},editTask:function(a){this.send("openModal","tasksEdit",a,null,null,!1)},removeTask:function(a){a.deleteRecord(),a.get("isDeleted"),a.save()}}}),Ember.Handlebars.helper("format-date",function(a){if(a){var b=a.getMonth()+1,c=a.getDate();return 10>b&&(b="0"+b),10>c&&(c="0"+c),"%@-%@-%@".fmt(c,b,a.getFullYear())}}),Ember.Handlebars.registerHelper("eachIndexed",function(a,b){function c(){var a=arguments[1].data.keywords,b=arguments[1].data.view,c=b.contentIndex,e=b._parentView.get("content")||[],g=e.get("length");return a.index=c,a.index_1=c+1,a.first=0===c,a.last=c+1===g,a.even=c%2===0,a.odd=!a.even,a.blockstart=c%f===0,a.blockend=a.last||c>0&&(c+1)%f===0,arguments[1].data.keywords=a,d.apply(this,arguments)}var d,e="item",f=6;return 4===arguments.length&&(Ember.assert("If you pass more than one argument to the eachIndexed helper, it must be in the form #eachIndexed foo in bar","in"===arguments[1]),Ember.assert(arguments[0]+" is a reserved word in #eachIndexed",$.inArray(arguments[0],["index","index+1","even","odd"])),e=arguments[0],b=arguments[3],a=arguments[2],b.hash.keyword=e,""===a&&(a="this")),1===arguments.length&&(b=a,a="this"),d=b.fn,b.fn=c,b.hash.dataSourceBinding=a,!b.data.insideGroup||b.hash.groupedRows||b.hash.itemViewClass?Ember.Handlebars.helpers.collection.call(this,"Ember.Handlebars.EachView",b):void new Ember.Handlebars.GroupedEach(this,a,b).render()}),App.Measurementhelper={cloneMeasurement:function(a,b,c){c=c||function(a){};var d=b.createRecord("measurement",a.toJSON());a.get("measurementitems").then(function(a){var e=a.toArray();d.get("measurementitems").then(function(a){for(var f=0;f<e.length;f++)a.pushObject(b.createRecord("measurementitem",e[f].toJSON()));c(d)})})},copyMeasurement:function(a,b,c,d){d=d||function(){},b.set("name",a.get("name")),b.get("type",a.get("type")),a.get("measurementitems").then(function(a){var e=a.toArray();b.get("measurementitems").then(function(a){var f=a.toArray();async.forEach(e,function(b,d){for(var g=!1,h=0;h<f.length;h++)if(f[h].get("itemname")===b.get("itemname")){f[h].setProperties(e[h].toJSON()),g=!0;break}g||a.pushObject(c.createRecord("measurementitem",b.toJSON())),d()},function(){d(b)})})})},deleteMeasurement:function(a,b,c){(void 0===b||null===b)&&(b=!0),c=c||function(){},a.get("measurementitems").then(function(d){for(var e=d.toArray(),f=0;f<e.length;f++){var g=e[f].get("isNew");e[f].deleteRecord(),b&&!g&&e[f].save()}var h=a.get("isNew");a.deleteRecord(),b&&!h&&a.save(),c()})},rollbackMeasurement:function(a,b){b=b||function(){},a.get("measurementitems").then(function(c){for(var d=c.toArray(),e=0;e<d.length;e++)d[e].rollback();a.rollback(),b()})},saveMeasurement:function(a,b){b=b||function(){},a.get("measurementitems").then(function(c){for(var d=c.toArray(),e=[],f=0;f<d.length;f++)e.push(d[f].save());Ember.RSVP.all(e).then(function(){a.save().then(function(){b()})})})},saveMeasurementConfig:function(a,b,c){b=b||function(){},c=c||function(){},a.get("measurementitems").then(function(d){for(var e=d.toArray(),f=[],g=0;g<e.length;g++)f.push(e[g].save());Ember.RSVP.all(f).then(function(){a.save().then(b,c)})})},copyMeasurementConfig:function(a,b,c){c=c||function(){};var d=b.createRecord("measurementconfig",{type:a.get("type")+"_new"});a.get("measurementitems").then(function(a){for(var e=a.toArray(),f=[],g=0;g<e.length;g++){var h=b.createRecord("measurementitemconfig",e[g].toJSON());f.push(h)}async.forEach(f,function(a,b){a.save().then(function(){b()})},function(){d.get("measurementitems").then(function(a){a.pushObjects(f),d.save().then(function(){c()},function(a){window.alert("Failed to save. Reason: "+a.responseJSON.message),App.Measurementhelper.deleteMeasurementConfig(d)})})})})},deleteMeasurementConfig:function(a,b,c){(void 0===b||null===b)&&(b=!0),c=c||function(){},a.get("measurementitems").then(function(d){for(var e=d.toArray(),f=0;f<e.length;f++){var g=e[f].get("isNew");e[f].deleteRecord(),b&&!g&&e[f].save()}var h=a.get("isNew");a.deleteRecord(),b&&!h&&a.save(),c()})}},App.OrderCustomerCommonHelper={cancel:function(a,b){a.get("measurements").then(function(a){var b=a.toArray();async.forEach(b,c,d)});var c=function(b,c){b.get("isNew")?(a.get("measurements").removeObject(b),App.Measurementhelper.deleteMeasurement(b)):App.Measurementhelper.rollbackMeasurement(b),c()},d=function(){a.get("isNew")?a.deleteRecord():a.rollback(),b&&b()}},"delete":function(a,b){b=b||function(){},a.get("measurements").then(function(a){var b=a.toArray();async.forEach(b,c,d)});var c=function(a,b){App.Measurementhelper.deleteMeasurement(a,!0,b)},d=function(){var c=a.get("isNew");a.deleteRecord(),c||a.save(),b()}}},Ember.Validations.validators.local.MeasurementValidator=Ember.Validations.validators.Base.extend({call:function(){var a=this.model.get("itemname"),b=this.model.get("parentController").get("model").get("type"),c=this.model.get(this.property),d=this;App.MeasurementConfigServiceInstance.findMeasurementItemConfig(b,a,function(a){void 0!==a&&null!==a&&(c<a.get("min")||c>a.get("max"))&&d.errors.pushObject("Value should be between ["+a.get("min")+"-"+a.get("max")+"]")})}}),App.Customer=DS.Model.extend({name:DS.attr("string"),phoneno:DS.attr("string"),emailid:DS.attr("string"),addressline1:DS.attr("string"),addressline2:DS.attr("string"),addressline3:DS.attr("string"),measurements:DS.hasMany("measurement",{async:!0})}),App.Customer.FIXTURES=[{id:1,name:"lavanya",phoneno:"9500037396",emailid:"lavrajan@gmail.com",addressline1:"",addressline2:"",addressline3:"",measurements:[1,2]},{id:2,name:"ahana",phoneno:"96000373796",emailid:"rajan@gmail.com",addressline1:"",addressline2:"",addressline3:"",measurements:[3,4]}],App.Measurementconfig=DS.Model.extend({type:DS.attr("string"),measurementitems:DS.hasMany("measurementitemconfig",{async:!0})}),App.Measurementitemconfig=DS.Model.extend({itemname:DS.attr("string"),min:DS.attr("number"),max:DS.attr("number")}),App.Measurementconfig.FIXTURES=[{id:1,type:"SK",measurementitems:[1,2]}],App.Measurementitemconfig.FIXTURES=[{id:1,itemname:"length",min:0,max:100},{id:2,itemname:"slit",min:0,max:100}],App.Measurement=DS.Model.extend({type:DS.attr("string"),name:DS.attr("string"),measurementitems:DS.hasMany("measurementitem",{async:!0}),additionalnote:DS.attr("string")}),App.Measurementitem=DS.Model.extend({itemname:DS.attr("string"),itemvalue:DS.attr("number")}),App.Measurement.FIXTURES=[{id:1,type:"SK",name:"main",measurementitems:[1,2],additionalnode:""},{id:2,type:"BL",name:"main",measurementitems:[1,2],additionalnode:""},{id:3,type:"SK",name:"kid",measurementitems:[1,2],additionalnode:""},{id:4,type:"BL",name:"kid",measurementitems:[1,2],additionalnode:""}],App.Measurementitem.FIXTURES=[{}],App.Order=DS.Model.extend({orderno:DS.attr("number"),orderdate:DS.attr("date"),customername:DS.attr("string"),customerphoneno:DS.attr("string"),customeremailid:DS.attr("string"),readydate:DS.attr("date"),duedate:DS.attr("date"),nopieces:DS.attr("number"),status:DS.attr("string"),additionalnote:DS.attr("string"),measurements:DS.hasMany("measurement",{async:!0})}),App.Order.FIXTURES=[{id:1,orderno:1,orderdate:new Date,customername:"lavanya",customerphoneno:"9500037396",customeremailid:"",duedate:new Date,nopieces:2,status:"New",additionalnote:"",measurements:[3]}],App.Ordersummary=DS.Model.extend({duedate:DS.attr("date"),newcount:DS.attr("number"),inprogresscount:DS.attr("number"),donecount:DS.attr("number")}),App.Ordersummary.FIXTURES=[{id:1,duedate:new Date,newcount:1,inprogresscount:1,donecount:1}],App.Task=DS.Model.extend({seqid:DS.attr("number"),taskname:DS.attr("string")}),App.Task.FIXTURES=[{id:1,seqid:1,taskname:"t1"},{id:2,seqid:2,taskname:"t2"},{id:3,seqid:3,taskname:"t3"}],App.Router.map(function(){this.route("index",{path:"/"}),this.route("about",{path:"/about"}),this.resource("tasks",{path:"tasks"},function(){console.log("Inside tasks....")}),this.resource("measurementconfigs",{path:"measurementconfigs"},function(){console.log("Inside measurementconfigs...."),this.route("new",{path:"/new"}),this.route("edit",{path:"/:config_id"})}),this.resource("customers",{path:"customers"},function(){console.log("Inside customers...."),this.route("new",{path:"/new"}),this.route("edit",{path:"/:cust_id"})}),this.resource("orders",{path:"orders"},function(){console.log("Inside orders...."),this.route("new",{path:"/new"}),this.route("edit",{path:"/:order_id"}),this.route("print",{path:"/print/:order_id"})})}),App.ApplicationRoute=Ember.Route.extend({init:function(){App.MeasurementConfigServiceInstance=App.MeasurementConfigService.create(),App.MeasurementConfigServiceInstance.set("store",this.store)},actions:{openModal:function(a,b,c,d,e){return void 0!==e&&this.controllerFor(a).set("isNew",e),this.controllerFor(a).set("model",b),d&&this.controllerFor(a).set("parentModel",d),c&&this.controllerFor(a).set("originalModel",c),this.render(a,{into:"application",outlet:"modal",view:"modal"})},closeModal:function(){return this.disconnectOutlet({outlet:"modal",parentView:"application"})}}}),App.CustomersIndexRoute=Ember.Route.extend({model:function(){return this.store.find("customer")},renderTemplate:function(){this.render("customersindex",{into:"application"})}}),App.CustomersEditRoute=Ember.Route.extend({model:function(a){return this.store.find("customer",a.cust_id)},setupController:function(a,b){this.controllerFor("customers.edit").setProperties({isNew:!1,model:b,editableMeasurement:null})},renderTemplate:function(){this.render("customersedit",{into:"application"})},actions:{error:function(a,b){console.log(a.message)}}}),App.CustomersNewRoute=Ember.Route.extend({model:function(){return this.store.createRecord("customer")},setupController:function(a,b){this.controllerFor("customers.new").setProperties({isNew:!0,model:b,editableMeasurement:null})},renderTemplate:function(){this.render("customersedit",{into:"application"})}}),App.MeasurementconfigsIndexRoute=Ember.Route.extend({model:function(){return this.store.find("measurementconfig")},renderTemplate:function(){this.render("measurementconfigsindex",{into:"application"})}}),App.MeasurementconfigsEditRoute=Ember.Route.extend({model:function(a){return this.store.find("measurementconfig",a.config_id)},setupController:function(a,b){this.controllerFor("measurementconfigs.edit").setProperties({isNew:!1,model:b})},renderTemplate:function(){this.render("measurementconfigsedit",{into:"application"})}}),App.MeasurementconfigsNewRoute=Ember.Route.extend({model:function(){return this.store.createRecord("measurementconfig")},setupController:function(a,b){this.controllerFor("measurementconfigs.edit").setProperties({isNew:!0,model:b})},renderTemplate:function(){this.render("measurementconfigsedit",{into:"application"})}}),App.OrdersIndexRoute=Ember.Route.extend({model:function(){return this.store.find("order",{status:["New","InProgress","Done"]})},setupController:function(a,b){this.controllerFor("orders.index").setProperties({model:b,filterByStatusNew:!0,filterByStatusInProgress:!0,filterByStatusDone:!0,filterByStatusDelivered:!1,filterByDueDate:"0"})},renderTemplate:function(){this.render("ordersindex",{into:"application"})}}),App.OrdersEditRoute=Ember.Route.extend({model:function(a){return this.store.find("order",a.order_id)},setupController:function(a,b){this.controllerFor("orders.edit").setProperties({isNew:!1,model:b,editableMeasurement:null,removedMeasurements:[]})},renderTemplate:function(){this.render("ordersedit",{into:"application"})},actions:{error:function(a,b){console.log(a.message)}}}),App.OrdersNewRoute=Ember.Route.extend({model:function(){return this.store.createRecord("order",{status:"New",orderdate:new Date,duedate:new Date})},setupController:function(a,b){this.controllerFor("orders.new").setProperties({isNew:!0,model:b,editableMeasurement:null,removedMeasurements:[]})},renderTemplate:function(){this.render("ordersedit",{into:"application"})}}),App.OrdersPrintRoute=Ember.Route.extend({model:function(a){return this.store.find("order",a.order_id)},setupController:function(a,b){console.log("setting controller for print page"),this.controllerFor("orders.print").setProperties({model:b})},renderTemplate:function(){this.render("ordersprint",{into:"application"})},actions:{error:function(a,b){console.log(a.message)}}}),App.TasksIndexRoute=Ember.Route.extend({model:function(){return this.store.find("task")},renderTemplate:function(){this.render("tasksindex",{into:"application"})}}),App.MeasurementConfigService=Ember.Object.extend({store:null,createMeasurementItems:function(a,b){b=b||function(a){};var c=this;this.store.find("measurementconfig",{type:a}).then(function(a){if(a.get("length")>0){var d=a.objectAt(0);d.get("measurementitems").then(function(a){for(var d=a.toArray(),e=d.length,f=[],g=0;e>g;g++){var h=c.store.createRecord("measurementitem");h.set("itemname",d[g].get("itemname")),h.set("itemvalue",d[g].get("itemvalue")),f.push(h)}b(f)})}})},findMeasurementItemConfig:function(a,b,c){c=c||function(a){},this.store.find("measurementconfig",{type:a}).then(function(a){if(a.get("length")>0){var d=a.objectAt(0);d.get("measurementitems").then(function(a){for(var d=a.toArray(),e=d.length,f=null,g=0;e>g;g++)if(d[g].get("itemname")===b){f=d[g];break}c(f)})}})},findMeasurementTypes:function(a){a=a||function(a){},this.store.find("measurementconfig").then(function(b){var c=[],d=b.toArray(),e=d.length;if(e>0){for(var f=0;e>f;f++)c.push(d[f].get("type"));a(c)}})}}),App.MeasurementConfigServiceInstance=null,App.StatusSummary=Ember.Object.extend({newcount:0,inprogresscount:0,donecount:0}),App.OrdersummaryService=Ember.Object.extend({store:null,totalnewcount:function(){return 0}.property(),totalinprogresscount:function(){return 0}.property(),totaldonecount:function(){return 0}.property(),daywisesummary:function(){return null}.property(),computesummary:function(){this.computecount(),this.computedayandweekwisesummary()},computedayandweekwisesummary:function(){var a={},b={},c=this,d=(this.store.filter("order",function(d){var e=a[d.get("duedate").toDateString()];e||(e=App.StatusSummary.create(),a[d.get("duedate").toDateString()]=e),c.updatecounts(e,d);var f=c.getweek(new Date(d.get("duedate"))),g=b[f];return g||(g=App.StatusSummary.create(),b[f]=g),c.updatecounts(g,d),!0}),[]),e=[];for(var f in a)d.push({duedate:new Date(f),newcount:a[f].newcount,inprogresscount:a[f].inprogresscount,donecount:a[f].donecount});d.sort(function(a,b){return a.duedate>b.duedate}),this.set("daywisesummary",d);for(var g in b)e.push({week:c.getWeekAsString(g),newcount:b[g].newcount,inprogresscount:b[g].inprogresscount,donecount:b[g].donecount});this.set("weekwisesummary",e)},getWeekAsString:function(a){var b=parseInt(a);return 0===b?"This Week":0>b?"Previous Week "+(-1*b).toString():"Week "+b.toString()},updatecounts:function(a,b){b.get("status")===App.Consts.OrderState.New&&a.set("newcount",a.get("newcount")+1),b.get("status")===App.Consts.OrderState.InProgress&&a.set("inprogresscount",a.get("inprogresscount")+1),b.get("status")===App.Consts.OrderState.Done&&a.set("donecount",a.get("donecount")+1)},getweek:function(a){var b=new Date,c=(6-b.getDay()+1)%7+1;return b.setDate(b.getDate()-(7-c)),b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0),this.weeksbetween(b,a)},weeksbetween:function(a,b){var c=6048e5,d=a.getTime(),e=b.getTime(),f=e-d;return Math.floor(f/c)},computecount:function(){var a=this,b=this.store.filter("order",function(a){return a.get("status")===App.Consts.OrderState.New});a.set("totalnewcount",b.get("length"));var c=this.store.filter("order",function(a){return a.get("status")===App.Consts.OrderState.InProgress});a.set("totalinprogresscount",c.get("length"));var d=this.store.filter("order",function(a){return a.get("status")===App.Consts.OrderState.Done});a.set("totaldonecount",d.get("length"))}}),App.DateField=Ember.TextField.extend({didInsertElement:function(){var a=this;return this.$().datepicker().on("changeDate",function(){a.$().trigger("change")})}}),App.DatePicker=Ember.TextField.extend({classNames:["date-picker"],textToDateTransform:function(a,b){
var c,d,e;return 2===arguments.length?b instanceof Date?(this.set("date",c),this.close()):b&&/\d{2}-\d{2}-\d{2}/.test(b)?(e=b.split("-"),c=new Date,c.setDate(e[0]),c.setMonth(e[1]-1),c.setYear(e[2]),this.set("date",c),this.close()):this.set("date",null):1===arguments.length&&this.get("date")?(d=this.get("date").getMonth()+1,c=this.get("date").getDate(),10>d&&(d="0"+d),10>c&&(c="0"+c),"%@-%@-%@".fmt(c,d,this.get("date").getFullYear())):void 0}.property(),format:"dd-mm-yyyy",placeholder:Ember.computed.alias("format"),size:8,valueBinding:"textToDateTransform",yesterday:function(){var a;return a=new Date,a.setDate(a.getDate()-1),a}.property(),didInsertElement:function(){var a=this;return this.$().datepicker({format:this.get("format"),autoclose:!0,todayHighlight:!0,keyboardNavigation:!1}).on("changeDate",function(b){return a.set("date",b.date),a.$().datepicker("setValue",b.date)})},close:function(){return this.$().datepicker("hide")}}),App.ModalView=Ember.View.extend({didInsertElement:function(){Ember.run.next(this,function(){this.$(".modal, .modal-backdrop").addClass("in")})},layoutName:"modal_layout",actions:{close:function(){var a=this;this.$(".modal, .modal-backdrop").one("transitionend",function(b){a.controller.send("close")}),this.$(".modal").removeClass("in")}}}),Ember.RadioButton=Ember.View.extend({tagName:"input",type:"radio",attributeBindings:["name","type","value","checked:checked:"],click:function(){this.set("selection",this.$().val())},checked:function(){return this.get("value")==this.get("selection")}.property()}),App.TextFieldEx=Em.TextField.extend({focusOut:function(){this.sendAction("targetAction",this.get("value"))}});